(self.webpackChunkE_Jurnal=self.webpackChunkE_Jurnal||[]).push([[8],{5008:function(e,t,n){n.r(t),n.d(t,{default:function(){return b}});var r=n(2791),a=n(9434),s=n(5054),o=n(4165),i=n(5861),c=n(9439),l=n(2564),u=(n(5462),n(1044)),d=n(1830),m=n.n(d),x=n(1087),p=n(8057),f=n(8329),g=n(184),h=function(){var e=(0,r.useState)(null),t=(0,c.Z)(e,2),n=t[0],a=t[1],s=(0,r.useState)(null),d=(0,c.Z)(s,2),h=d[0],b=d[1],v=(0,r.useState)(!1),k=(0,c.Z)(v,2),w=k[0],j=k[1],N=(0,r.useState)({hours:0,minutes:0,seconds:0}),Z=(0,c.Z)(N,2),y=Z[0],S=Z[1],A=(0,r.useState)([]),C=(0,c.Z)(A,2),E=C[0],P=C[1],I=(0,r.useState)(""),R=(0,c.Z)(I,2),T=R[0],D=R[1],B=(0,r.useRef)(null),z=(0,r.useRef)(null),L=f.Z.get("token"),_=(0,r.useState)([]),F=(0,c.Z)(_,2),G=(F[0],F[1]),J=JSON.parse(f.Z.get("user")),K=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p.Z.get("admin/industri/".concat(J.industri_id),{headers:{Authorization:"Bearer ".concat(L)}});case 3:t=e.sent,G(t.data.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching industri:",e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){K()}),[]),(0,r.useEffect)((function(){var e=function(){var e=new Date();S({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()})};e();var t=setInterval(e,1e3);return function(){return clearInterval(t)}}),[]),(0,r.useEffect)((function(){navigator.mediaDevices.enumerateDevices().then((function(e){var t=e.filter((function(e){return"videoinput"===e.kind}));P(t),t.length>0&&D(t[0].deviceId)}))}),[]),(0,r.useEffect)((function(){w&&U()}),[w,T]);var M=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t,n){var r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.ZP.get("https://nominatim.openstreetmap.org/reverse?lat=".concat(t,"&lon=").concat(n,"&format=json"));case 3:return r=e.sent,e.abrupt("return",r.data.display_name);case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error during reverse geocoding:",e.t0.message),e.abrupt("return","Alamat tidak ditemukan");case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),O=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:navigator.geolocation?navigator.geolocation.getCurrentPosition(function(){var e=(0,i.Z)((0,o.Z)().mark((function e(t){var n,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.coords.latitude,r=t.coords.longitude,e.next=4,M(n,r);case 4:e.sent,a({latitude:n,longitude:r}),j(!0);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()):l.Am.error("Geolocation is not supported by this browser.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){navigator.mediaDevices.getUserMedia({video:{deviceId:T}}).then((function(e){B.current.srcObject=e})).catch((function(e){console.error("Error accessing webcam: ",e.message),l.Am.error("Tidak dapat mengakses kamera. Pastikan Anda memberi izin.")}))},q=function(){var e=(0,i.Z)((0,o.Z)().mark((function e(){var t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m().fire({title:"Absen",text:"Apakah Anda yakin ingin absen?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, absen!"});case 2:if(!e.sent.isConfirmed){e.next=23;break}if(t={date:(new Date()).toLocaleDateString(),departureTime:y.hours+":"+y.minutes,arrivalTime:y.hours+":"+y.minutes,absenceReason:"hadir",longitude:n?n.longitude:null,latitude:n?n.latitude:null,image:h},console.log("Submitting the following data:",t),e.prev=6,t.date&&t.departureTime&&t.arrivalTime&&t.absenceReason&&t.longitude&&t.latitude&&t.image){e.next=10;break}throw console.error("Missing required fields:",t),new Error("Required fields are missing");case 10:return e.next=12,p.Z.post("/admin/absence",t,{headers:{Authorization:"Bearer ".concat(L)}});case 12:r=e.sent,l.Am.success(r.data.message,{position:"top-right",duration:4e3}),console.log("Attendance data submitted successfully:",t),H(),j(!1),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),console.error("Error submitting attendance:",e.t0.response?e.t0.response.data:e.t0.message),e.t0.response&&e.t0.response.data?(console.log("Server response error details:",e.t0.response.data),l.Am.error("Gagal melakukan absen. ".concat(e.t0.response.data.message||"Periksa kembali input Anda."),{position:"top-right",duration:4e3})):l.Am.error("Gagal melakukan absen. Periksa kembali input Anda.",{position:"top-right",duration:4e3});case 23:case"end":return e.stop()}}),e,null,[[6,19]])})));return function(){return e.apply(this,arguments)}}(),H=function(){a(null),b(null)};return(0,g.jsxs)("div",{className:"card-body mx-auto bg-base-100 h-90 rounded-xl text-center mt-[90px] mb-[80px] md:mt-[100px] md:h-[500px] md:w-1/3",children:[(0,g.jsx)("h1",{className:"text-2xl font-bold mb-4 md:text-3xl md:mt-5",children:"Absensi Siswa PKL"}),(0,g.jsx)("button",{onClick:O,className:"p-2 bg-green-500 text-white hover:bg-green-700 h-[150px] w-[150px] mx-auto rounded-full md:mt-5 md:h-[200px] md:w-[180px]",children:(0,g.jsx)("i",{className:"fa-solid fa-bell text-5xl md:text-7xl text-center"})}),(0,g.jsxs)("div",{className:"flex gap-1 justify-center mt-6",children:[(0,g.jsx)("div",{className:"flex flex-col p-2 bg-white rounded-box text-black-content dark:bg-[#1c2229]",children:(0,g.jsxs)("span",{className:"font-mono md:text-3xl text-2xl dark:text-white dark:bg-[#1c2229]",children:[y.hours.toString().padStart(2,"0")," :"]})}),(0,g.jsx)("div",{className:"flex flex-col p-2 bg-white rounded-box text-black-content dark:bg-[#1c2229]",children:(0,g.jsxs)("span",{className:"font-mono md:text-3xl text-2xl dark:text-white dark:bg-[#1c2229]",children:[y.minutes.toString().padStart(2,"0")," :"]})}),(0,g.jsx)("div",{className:"flex flex-col p-2 bg-white rounded-box text-black-content dark:bg-[#1c2229]",children:(0,g.jsx)("span",{className:"font-mono md:text-3xl text-2xl dark:text-white dark:bg-[#1c2229]",children:y.seconds.toString().padStart(2,"0")})})]}),(0,g.jsx)(x.rU,{className:"btn btn-primary mt-6 text-white mx-auto",to:"/app/rekap-absensi",children:" Riwayat Absen"}),w&&(0,g.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,g.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-lg w-11/12 md:w-1/3 relative",children:[(0,g.jsx)("button",{onClick:function(){return j(!1)},className:"absolute top-2 right-2 text-gray-600 hover:text-gray-900 text-2xl cursor-pointer",children:"\u2715"}),(0,g.jsx)("h3",{className:"font-bold text-lg md:text-3xl",children:"Absen Siswa PKL"}),(0,g.jsx)("label",{htmlFor:"camera-select",className:"block mt-4",children:"Pilih Kamera:"}),(0,g.jsx)("select",{id:"camera-select",className:"mt-2 p-2 bg-gray-100 text-black-100 rounded-md",onChange:function(e){return D(e.target.value)},value:T,children:E.map((function(e){return(0,g.jsx)("option",{value:e.deviceId,children:e.label||"Camera ".concat(E.indexOf(e)+1)},e.deviceId)}))}),h?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("img",{src:h,alt:"Preview",className:"mt-4 w-[1120px] h-[400px] mx-auto cursor-pointer"}),(0,g.jsx)("button",{onClick:function(){b(null),U()},className:"mt-4 p-2 bg-yellow-500 text-white rounded-md w-[200px] md:text-xl md:hover:bg-yellow-700",children:"Reset Camera"})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("video",{ref:B,autoPlay:!0,className:"mt-4 w-[1920px] h-[400px] mx-auto object-cover cursor-pointer"}),(0,g.jsxs)("button",{onClick:function(){z.current.getContext("2d").drawImage(B.current,0,0,z.current.width,z.current.height);var e=z.current.toDataURL("image/jpeg");b(e)},className:"mt-4 p-2 bg-gray-100 text-black-100 text-1xl rounded-md shadow-md",children:[h?"Take Again":"Take Photo",(0,g.jsx)("i",{className:"fa-solid fa-camera ml-2"})]}),(0,g.jsx)("canvas",{ref:z,className:"hidden"})]}),(0,g.jsx)("div",{className:"flex justify-center",children:(0,g.jsx)("button",{onClick:q,className:"mt-4 p-2 bg-blue-500 text-white rounded-md w-[200px] md:text-xl md:hover:bg-blue-700",children:"Submit"})})]})}),(0,g.jsx)(l.Ix,{})]})};var b=function(){var e=(0,a.I0)();return(0,r.useEffect)((function(){e((0,s.Iw)({title:"Absen"}))}),[]),(0,g.jsx)(h,{})}}}]);
//# sourceMappingURL=8.68fa9767.chunk.js.map