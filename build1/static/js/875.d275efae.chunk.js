"use strict";(self.webpackChunke_jurnal=self.webpackChunke_jurnal||[]).push([[875],{875:(e,t,a)=>{a.r(t),a.d(t,{default:()=>h});var n=a(7565),s=a(3292),r=a(4963),i=a(7850),o=(a(6804),a(201)),l=a(1774),d=a.n(l),c=a(896),m=a(6709),u=a(477),g=a(7929);const x=()=>{const[e,t]=(0,n.useState)(null),[a,s]=(0,n.useState)(null),[r,l]=(0,n.useState)(!1),[x,h]=(0,n.useState)({hours:0,minutes:0,seconds:0}),[p,b]=(0,n.useState)([]),[f,k]=(0,n.useState)(""),[v,w]=(0,n.useState)("masuk"),[j,y]=(0,n.useState)(!1),A=(0,n.useRef)(null),S=(0,n.useRef)(null),N=c.A.get("token");(0,n.useEffect)((()=>{(async()=>{try{const e=(await m.A.get("admin/absen-cek",{headers:{Authorization:`Bearer ${c.A.get("token")}`}})).data.message;console.log(e),"Masuk"===e?w("Masuk"):"Pulang"===e?w("Pulang"):"Anda sudah absen pulang hari ini, tidak bisa absen lagi."===e&&(y(!0),d().fire({title:"Sudah Absen",text:"Anda sudah absen masuk dan pulang hari ini.",icon:"info",confirmButtonText:"OK"}))}catch(e){console.error("Error fetching absen status:",e)}})()}),[]),(0,n.useEffect)((()=>{const e=()=>{const e=new Date;h({hours:e.getHours(),minutes:e.getMinutes(),seconds:e.getSeconds()})};e();const t=setInterval(e,1e3);return()=>clearInterval(t)}),[]),(0,n.useEffect)((()=>{navigator.mediaDevices.enumerateDevices().then((e=>{const t=e.filter((e=>"videoinput"===e.kind));b(t),t.length>0&&k(t[0].deviceId)}))}),[]),(0,n.useEffect)((()=>{r&&C()}),[r,f]);const C=()=>{navigator.mediaDevices.getUserMedia({video:{deviceId:f}}).then((e=>{const t=A.current;t.srcObject=e,t.onloadedmetadata=()=>{t.play(),S.current.width=t.videoWidth,S.current.height=t.videoHeight}})).catch((e=>{i.oR.error("Tidak dapat mengakses kamera. Pastikan Anda memberi izin.")}))},$=(e,t,a)=>`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}:${String(a).padStart(2,"0")}`;(0,n.useEffect)((()=>{console.log("Is Already Absent:",j)}),[j]);const P=()=>{t(null),s(null)};return(0,g.jsxs)("div",{className:"card-body mx-auto bg-base-100 h-100 rounded-xl text-center mt-[90px] mb-[80px] md:mt-[100px] md:h-[500px] md:w-1/3",children:[(0,g.jsx)("h1",{className:"text-2xl font-bold  md:text-3xl   md:mt-5 text-black font-poppins dark:text-white",children:"Absensi Siswa PKL"}),(0,g.jsx)("p",{className:"text-sm md:text-xl font-semibold md:mt-[-10px] mt-0 mb-3",children:j?"Anda sudah absen masuk dan pulang":"Masuk"===v?"Silahkan Absen Masuk":"Silahkan Absen Pulang"}),(0,g.jsx)("button",{onClick:async()=>{j?d().fire({title:"Sudah Absen",text:"Anda sudah absen masuk dan pulang hari ini.",icon:"info",confirmButtonText:"OK"}):navigator.geolocation?navigator.geolocation.getCurrentPosition((async e=>{const a=e.coords.latitude,n=e.coords.longitude;await(async(e,t)=>{try{return(await o.A.get(`https://nominatim.openstreetmap.org/reverse?lat=${e}&lon=${t}&format=json`)).data.display_name}catch(a){return"Alamat tidak ditemukan"}})(a,n);t({latitude:a,longitude:n}),l(!0)}),(e=>{i.oR.error("Tidak dapat mengakses lokasi. Pastikan Anda memberi izin.")})):i.oR.error("Geolocation tidak didukung oleh browser ini.")},className:`p-2 ${j?"bg-gray-500 hover:bg-gray-700":"bg-green-500 hover:bg-green-700"} ${"Pulang"===v?"bg-yellow-500 hover:bg-yellow-700":"bg-green-500 hover:bg-green-700"} text-white h-[150px] w-[150px] mx-auto rounded-full md:mt-5 md:h-[200px] md:w-[180px]`,children:(0,g.jsx)("i",{className:"fa-solid fa-bell text-5xl md:text-7xl text-center"})}),(0,g.jsx)("div",{className:"flex justify-center mt-6",children:(0,g.jsxs)("div",{className:"flex items-center p-2  text-black-500  dark:from-gray-800 dark:to-gray-900 rounded-xl shadow-lg ",children:[(0,g.jsx)("span",{className:"font-poppins md:text-3xl text-2xl tracking-widest transition-transform duration-300 ease-in-out transform hover:scale-110",children:x.hours.toString().padStart(2,"0")}),(0,g.jsx)("span",{className:"font-poppins md:text-3xl text-2xl mx-1",children:":"}),(0,g.jsx)("span",{className:"font-poppins md:text-3xl text-2xl tracking-widest transition-transform duration-300 ease-in-out transform hover:scale-110",children:x.minutes.toString().padStart(2,"0")}),(0,g.jsx)("span",{className:"font-poppins md:text-3xl text-2xl mx-1",children:":"}),(0,g.jsx)("span",{className:"font-poppins md:text-3xl text-2xl tracking-widest transition-transform duration-300 ease-in-out transform hover:scale-110",children:x.seconds.toString().padStart(2,"0")}),(0,g.jsx)("span",{className:"font-poppins md:text-3xl text-2xl ml-2",children:"WIB"})]})}),(0,g.jsxs)(u.N_,{className:"btn bg-green-500 hover:bg-green-700 mt-6 text-white mx-auto",to:"/app/rekap-absensi",children:[" ","Riwayat Absen"]}),r&&(0,g.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50",children:(0,g.jsxs)("div",{className:"bg-white dark:bg-[#1c2229] p-6 rounded-lg shadow-lg w-11/12 md:w-1/3 relative",children:[(0,g.jsx)("button",{onClick:()=>l(!1),className:"absolute top-2 right-2 text-gray-600 hover:text-gray-400 text-2xl cursor-pointer",children:"\u2715"}),(0,g.jsx)("h2",{className:"font-bold text-lg md:text-3xl dark:text-white",children:"Absen Siswa PKL"}),(0,g.jsx)("p",{className:"text-lg font-semibold mb-4",children:j?"Anda sudah absen masuk dan pulang":"Masuk"===v?"Silahkan Absen Masuk":"Silahkan Absen Pulang"}),(0,g.jsx)("label",{htmlFor:"camera-select",className:"block mt-4 dark:text-white",children:"Pilih Kamera:"}),(0,g.jsx)("select",{id:"camera-select",className:"mt-2 p-2 bg-gray-100 text-black-100 dark:bg-gray-700  rounded-md cursor-pointer",onChange:e=>k(e.target.value),value:f,children:p.map((e=>(0,g.jsx)("option",{value:e.deviceId,children:e.label||`Camera ${p.indexOf(e)+1}`},e.deviceId)))}),a?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("img",{src:a,alt:"Preview",className:"mt-4 w-full h-auto mx-auto cursor-pointer object-cover"}),(0,g.jsxs)("button",{onClick:()=>{s(null),C()},className:"mt-4 p-2 bg-gray-100 dark:bg-gray-700 text-black-100 text-1xl rounded-md shadow-md",children:[a?"Ambil Ulang":"Ambil Foto",(0,g.jsx)("i",{className:"fa-solid fa-camera ml-2"})]})]}):(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("video",{ref:A,autoPlay:!0,style:{width:"100%"},className:"mt-4 w-full h-auto mx-auto object-cover cursor-pointer"}),(0,g.jsxs)("button",{onClick:()=>{const e=A.current;S.current.getContext("2d").drawImage(e,0,0,e.videoWidth,e.videoHeight);const t=S.current.toDataURL("image/jpeg");s(t)},className:"mt-4 p-2 bg-gray-100 text-black-100 text-1xl rounded-md shadow-md dark:bg-gray-700",children:[a?"Ambil Ulang":"Ambil Foto",(0,g.jsx)("i",{className:"fa-solid fa-camera ml-2"})]}),(0,g.jsx)("canvas",{ref:S,className:"hidden",width:640,height:480})]}),(0,g.jsx)("div",{className:"flex justify-center",children:(0,g.jsx)("button",{onClick:async()=>{if((await d().fire({title:"Absen",text:"Apakah Anda yakin ingin absen?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, absen!"})).isConfirmed){const o=new Date,d=new FormData;if(d.append("date",`${(s=o).getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`),d.append("time",$(x.hours,x.minutes,x.seconds)),d.append("absenceReason","hadir"),d.append("longitude",e?e.longitude:null),d.append("latitude",e?e.latitude:null),a){const e=a.split(",")[1],t=atob(e),n=new Array(t.length);for(let a=0;a<t.length;a++)n[a]=t.charCodeAt(a);const s=new Uint8Array(n),r=new Blob([s],{type:"image/jpeg"});d.append("image",r,"photo.jpg")}try{const e="/admin/absence",t=await m.A.post(e,d,{headers:{Authorization:`Bearer ${N}`,"Content-Type":"multipart/form-data"}});i.oR.success(t.data.message,{position:"top-right",duration:4e3}),P(),l(!1)}catch(r){var t,n;const e=(null===(t=r.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.error)||r.message;i.oR.error(`Gagal melakukan absen. ${e}`,{position:"top-right",duration:4e3})}}var s},className:"mt-4 p-2 bg-blue-500 text-white rounded-md w-[200px] md:text-xl md:hover:bg-blue-700",children:"Absen"})})]})}),(0,g.jsx)(i.N9,{})]})};const h=function(){const e=(0,s.wA)();return(0,n.useEffect)((()=>{e((0,r.wE)({title:"Absen"}))}),[]),(0,g.jsx)(x,{})}},6804:()=>{}}]);
//# sourceMappingURL=875.d275efae.chunk.js.map